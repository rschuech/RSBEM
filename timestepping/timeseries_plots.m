runs = ["C:\Users\rudi\Desktop\RD\temp\E 10 eta 500 d 0.05 g 50 link_breakage dist 0.2.mat",...
    "Z:\temp\E 10 eta 500 d 0.05 g 0 link_breakage dist 0.mat",...
    "Y:\temp\E 10 eta 500 d 0.05 g 50 link_breakage dist 0.mat",...
    "X:\temp\E 10 eta 500 d 0.05 g 500 link_breakage dist 0.mat",...
    ];

runs = ["C:\Users\rudi\Desktop\RD\temp\E 10 eta 500 d 0.05 g 50 link_breakage dist 0 reltol 1E-5 abstol 1E-8.mat",...
    "Z:\temp\E 10 eta 500 d 0.05 g 0 link_breakage dist 0.mat",...
    "Y:\temp\E 10 eta 500 d 0.05 g 50 link_breakage dist 0.mat",...
    "X:\temp\E 10 eta 500 d 0.05 g 500 link_breakage dist 0.mat",...
    ];

runs = ["Z:\temp\E 10 eta 500 d 0.05 g 0 link_breakage dist 0.mat",...
    "Y:\temp\E 10 eta 500 d 0.05 g 50 link_breakage dist 0.mat",...
    "C:\Users\rudi\Desktop\RD\temp\E 10 eta 500 d 0.05 g 50 link_breakage dist 0 reltol 1E-5 abstol 1E-8.mat",...
    "C:\Users\rudi\Desktop\RD\temp\E 10 eta 500 d 0.05 g 50 link_breakage dist 0 reltol 5E-4 abstol 5E-4 epsilon 4E-4.mat",...
    "Y:\temp\E 10 eta 500 d 0.05 g 50 link_breakage dist 0 reltol 5E-4 abstol 5E-4 epsilon 4E-3.mat",...
    ];

runs = ["C:\Users\rudi\Desktop\RD\temp\no_trespassing_fix.mat",...
    "C:\Users\rudi\Desktop\RD\temp\trespassing_fix.mat",...
    "C:\Users\rudi\Desktop\RD\temp\trespassing_fix_set_initial_step.mat",...
    ];

runs = ["C:\Users\rudi\Desktop\RD\temp\no_trespassing_fix.mat",...
    "C:\Users\rudi\Desktop\RD\temp\no_fix_initial_step.mat",...
    "C:\Users\rudi\Desktop\RD\temp\fix_initial_step_finished.mat",...
    ];

runs = ["C:\Users\rudi\Desktop\RD\temp\no fix reltol 1E-4 abstol 1E-9",...
    "C:\Users\rudi\Desktop\RD\temp\no fix maxstep 1E-3",...
    "C:\Users\rudi\Desktop\RD\temp\no fix maxstep 2E-3",...
    ];

runs = [ "C:\Users\rudi\Desktop\RD\temp\no fix maxstep 2E-3",...
    "C:\Users\rudi\Desktop\RD\temp\no fix maxstep 2E-3 again",...
    ];

runs = [ "C:\Users\rudi\Desktop\RD\temp\nofix timestep convergence maxstep 4E-3.mat",...
    "C:\Users\rudi\Desktop\RD\temp\no fix maxstep 2E-3.mat",...
    "C:\Users\rudi\Desktop\RD\temp\CFD195 maxstep 2E-3.mat",...
    "C:\Users\rudi\Desktop\RD\temp\nofix timestep convergence maxstep 1E-3.mat",...
    "C:\Users\rudi\Desktop\RD\temp\nofix timestep convergence maxstep 5E-4.mat",...
    "C:\Users\rudi\Desktop\RD\temp\nofix timestep convergence maxstep 2.5E-4.mat",...
    ];

runs = [ "C:\Users\rudi\Desktop\RD\temp\no links timestepping convergence maxstep 4E-3.mat",...
    "C:\Users\rudi\Desktop\RD\temp\no links timestepping convergence maxstep 2E-3.mat",...
    "C:\Users\rudi\Desktop\RD\temp\no links timestepping convergence maxstep 1E-3.mat",...
    "C:\Users\rudi\Desktop\RD\temp\no links timestepping convergence maxstep 5E-4.mat",...
    ];

% runs = [ "C:\Users\rudi\Desktop\RD\temp\link breakage 0.2 maxstep 4E-3.mat",...
%      "C:\Users\rudi\Desktop\RD\temp\link breakage 0.2 maxstep 2E-3.mat",...
%       "C:\Users\rudi\Desktop\RD\temp\link breakage 0.2 maxstep 1E-3.mat",...
%        "C:\Users\rudi\Desktop\RD\temp\link breakage 0.2 maxstep 0.5E-3.mat",...
%         "C:\Users\rudi\Desktop\RD\temp\link breakage 0.2 maxstep 0.25E-3.mat",...
% ];
%
% runs = ["C:\Users\rudi\Desktop\RD\temp\link breakage body 0.2 tail 0.2 maxstep 1E-3.mat",...
%         "C:\Users\rudi\Desktop\RD\temp\link breakage body 0.2 tail 0.2 maxstep 0.5E-3.mat",...
%     ];
%
% runs = ["C:\Users\rudi\Desktop\RD\temp\link breakage body 0 tail 0.2 maxstep 1E-3.mat",...
%         "C:\Users\rudi\Desktop\RD\temp\link breakage body 0 tail 0.2 maxstep 0.5E-3.mat",...
%     ];
%
% runs = ["C:\Users\rudi\Desktop\RD\temp\link breakage 0.2 maxstep 1E-3.mat",...
%         "C:\Users\rudi\Desktop\RD\temp\link breakage 0.2 maxstep 0.5E-3.mat",...
%     ];
% tstr = "Breakage distance body 0.2 tail 0";


runs = ["C:\Users\rudi\Desktop\RD\temp\no breakage network offset maxstep 1E-3.mat",...
    "C:\Users\rudi\Desktop\RD\temp\no breakage network offset maxstep 0.5E-3.mat",...
    ];

% runs = ["C:\Users\rudi\Desktop\RD\temp\nofix timestep convergence maxstep 1E-3.mat",...
%     "C:\Users\rudi\Desktop\RD\temp\CFD197 maxstep 1E-3.mat",...
%     ];
% runs = [ "C:\Users\rudi\Desktop\RD\temp\CFD195 maxstep 4E-3.mat",...
%     "C:\Users\rudi\Desktop\RD\temp\CFD196 maxstep 4E-3.mat",...
%     "C:\Users\rudi\Desktop\RD\temp\CFD197 maxstep 4E-3.mat",...
%     "C:\Users\rudi\Desktop\RD\temp\CFD198 maxstep 4E-3.mat",...
%     ];

% runs = [ "C:\Users\rudi\Desktop\RD\temp\CFD195 maxstep 4E-3.mat",...
%  "C:\Users\rudi\Desktop\RD\temp\nofix timestep convergence maxstep 4E-3.mat",...
%  ];
% runs = [ "C:\Users\rudi\Desktop\RD\temp\nofix maxstep 4E-3 rep1.mat",...
%     "C:\Users\rudi\Desktop\RD\temp\nofix maxstep 4E-3 rep2.mat",...
%      "C:\Users\rudi\Desktop\RD\temp\nofix timestep convergence maxstep 4E-3.mat",...
%     ];



runs = [ "C:\Users\rudi\Desktop\RD\temp\nofix timestep convergence maxstep 1E-3.mat",...
    "C:\Users\rudi\Desktop\RD\temp\link breakage 0.2 maxstep 1E-3.mat",...
     "C:\Users\rudi\Desktop\RD\temp\link breakage body 0.4 tail 0 maxstep 1E-3.mat",...
      "C:\Users\rudi\Desktop\RD\temp\link breakage body 0.8 tail 0 maxstep 1E-3.mat",...
       "C:\Users\rudi\Desktop\RD\temp\link breakage body 1.6 tail 0 maxstep 1E-3.mat",...
    ];


runs = [ "C:\Users\rudi\Desktop\RD\temp\link breakage body 0.2 tail 0.2 E 100 eta 5000 maxstep 1E-3.mat",...
    "C:\Users\rudi\Desktop\RD\temp\link breakage body 0.2 tail 0.2 E 100 eta 5000 maxstep 0.5E-3.mat"];
    

%     runs = [ "C:\Users\rudi\Desktop\RD\temp\link breakage body 0 tail 0 E 100 eta 5000 maxstep 1E-3.mat",...
%     "C:\Users\rudi\Desktop\RD\temp\link breakage body 0.1 tail 0.1 E 100 eta 5000 maxstep 1E-3.mat",...
%      "C:\Users\rudi\Desktop\RD\temp\link breakage body 0.2 tail 0.2 E 100 eta 5000 maxstep 1E-3.mat",...
%       "C:\Users\rudi\Desktop\RD\temp\link breakage body 0.4 tail 0.4 E 100 eta 5000 maxstep 1E-3.mat",...
%     ];

    runs = [ "C:\Users\rudi\Desktop\RD\temp\link breakage body 0 tail 0 E 100 eta 5000 long network maxstep 1E-3.mat",...
     "C:\Users\rudi\Desktop\RD\temp\link breakage body 0.2 tail 0.2 E 100 eta 5000 long network maxstep 1E-3.mat",...
   "C:\Users\rudi\Desktop\RD\temp\link breakage body 0.4 tail 0.4 E 100 eta 5000 long network maxstep 1E-3.mat",...
    ];


runs = [ "C:\Users\rudi\Desktop\RD\temp\link breakage body 0 tail 0 E 100 eta 5000 long network maxstep 1E-3.mat",...
    "C:\Users\rudi\Desktop\RD\temp\link breakage body 0 tail 0 E 100 eta 5000 long network with tube maxstep 1E-3.mat",...
           "C:\Users\rudi\Desktop\RD\temp\link breakage body 0 tail 0 E 100 eta 5000 long network wider tube maxstep 1E-3.mat",...
           ];
       
       runs = ["C:\Users\rudi\Desktop\RD\temp\link breakage body 0 tail 0, E 10 eta 500, maxstep 1E-3, no iterative refinement.mat",...
           "C:\Users\rudi\Desktop\RD\temp\link breakage body 0 tail 0, E 10 eta 500, maxstep 1E-3, no iterative refinement, perturbed network0.mat",...
           "C:\Users\rudi\Desktop\RD\temp\link breakage body 0 tail 0, E 10 eta 500, maxstep 1E-3, iterative refinement.mat",...
           "C:\Users\rudi\Desktop\RD\temp\link breakage body 0 tail 0, E 10 eta 500, maxstep 1E-3, iterative refinement, perturbed network0.mat"];

names = ["g = 50 with breakage","g = 0 no breakage","g = 50 no breakage","g = 500 no breakage"];
names = ["g = 50 refined ode45","g = 0","g = 50","g = 500"];
names = ["g = 0", "g = 50", "g = 50 refined ode45", "g = 50 epsilon*10", "g = 50 epsilon*100" ];
names = ["no fix","fix","fix with initialstep"];
names = ["no fix","no fix initial step","fix initial step"];

names = [ "no fix, reltol 1E-4, abstol 1E-9",...
    "no fix maxstep 1E-3", "no fix maxstep 2E-3"];



names = ["4E-3","2E-3","2E-3","1E-3","0.5E-3","0.25E-3"];
names = ["4E-3","2E-3","1E-3","0.5E-3"];
% names = ["4E-3","2E-3","1E-3","0.5E-3","0.25E-3"];
% names = ["1E-3","0.5E-3"];
% names = ["0","0.2","0.4","0.8","1.6"];
% names = ["0","0.1","0.2","0.4"];
names = ["0","0.2","0.4"];

names = ["no tube", "tube","wider tube"];
names = ["no refine, no perturb","no refine, perturb","refine, no perturb","refine, perturb"];

tstr = "link breakage distances for body + tail, E 100 eta 5000 maxstep 1E-3";

tstr = "stiff Network convergence check";

tstr = "long network with tube";
tstr = "iterative refinement";

% styles = ["-",":","-.","--"];
colors = distinguishable_colors(length(names));
tfinal = Inf;
torque = 1000;
figure(467); clf;

% tiledlayout(6,1);
tiledlayout(4,1);
run_inds = [ 1 2 3 4 ];
% run_inds = 1:length(names);
smoothing = false;
fieldname = 'trespassing';
% fieldname = 'repulsion';
clear windows
c = 0;
for i = run_inds
    i
    
    load(runs(i),'stored_output');
    jc = 0;  j_inds = [1 2 3 5];
    for j = j_inds
        jc = jc+1;
        switch j
            case 1 % speed
                y = sqrt(sum(stored_output.derivatives(:,1:3).^2,2));
%                 y = sqrt(sum(stored_output.derivatives(:,1).^2,2));
                lims = [3.5 22];
                label = '|U| (\mum s^{-1})';
            case 2 % tail freq
                y = stored_output.derivatives(:,7);
                lims = [410 460];
                label = ('tail rad/s');
            case 3 % microns traveled / revolution
                                y = sqrt(sum(stored_output.derivatives(:,1:3).^2,2)) ./ ( stored_output.derivatives(:,7) * 1/(2*pi) );
%                 y = sqrt(sum(stored_output.derivatives(:,1).^2,2)) ./ ( stored_output.derivatives(:,7) * 1/(2*pi) );
                lims = [0.05 0.3];
                label = ('\mum / tail rev');
                %             case 4 % efficiency = speed^2 / (freq * torque)
                % %                 y =  (sum(stored_output.derivatives(:,1:3).^2 , 2)) ./ (stored_output.derivatives(:,7) .* torque );
                %   y =  (sum(stored_output.derivatives(:,1).^2 , 2)) ./ (stored_output.derivatives(:,7) .* torque );
                %                 lims = [0 1E-3];
                %                  label = '|U|^2 / (freq * torque)';
                
            case 4 % how many network nodes are inside mesh
                %                 y =  (sum(stored_output.derivatives(:,1:3).^2 , 2)) ./ (stored_output.derivatives(:,7) .* torque );
                fun = @(is_inside,submesh_index) sum(submesh_index == 1 & is_inside);  % count only inside body
                % fun = @(is_inside,submesh_index) sum(submesh_index == 2 & is_inside);  % count only inside tail
                % fun = @(is_inside,submesh_index) sum( (submesh_index == 1 | submesh_index == 2) & is_inside);  % count inside body or tail
                y = zeros(length(stored_output.time),1);  % default is none are inside
                y(stored_output.(fieldname).any_flagged) = cellfun( fun, stored_output.(fieldname).is_inside, stored_output.(fieldname).submesh_index);
                
                lims = [0 Inf];
                label = '# nodes inside';
                
            case 5 % PE
                y = stored_output.PE;
                lims = [0 2E3];
                label = 'PE';
            case 6 % repulsion force on swimmer
                y = stored_output.(fieldname).total_force_mag;
                lims = [0 270];
                label = 'repulsion';
        end
        if smoothing
            [y, window] = smoothdata(y,'movmean',20);
            c = c+1;
            windows(c) = window;
        end
        
        nexttile(jc)
        
        % ax2 = axes('position',  [ 0.068765      0.37856     0.8875       0.1551],'FontSize',11);
        % yyaxis left
        % velocity_plot = plot(stored_output.time(1:1),sqrt(sum(stored_output.derivatives(1:1,1:3).^2,2)),'-','LineWidth',2);
        plot(stored_output.time,y,'LineWidth',2,'Color',colors(i,:));
        if jc == 1
            title(tstr);
        end
        % ylabel('|U| (\mum s^{-1})');
        % xlabel('time (s)');
         xlim([0 tfinal]);
        % ylim(lims);
        ylabel(label);
        hold on
        grid on
        
        set(gca,'FontSize',12);
        if jc == length(j_inds) && i == run_inds(end)
            legend(names(run_inds),'Location','best','FontSize',14);
        end
        
        % ylabel('|U|^2 / power','color','r');
        % ylabel('PE');
        % xlabel('time (s)');
        % ylabel('repulsive force');
        
        % repulsion_force_plot = plot(stored_output.time,stored_output.repulsion.total_torque_mag,'-','linewidth',2);
        % ylabel('repulsive torque');
        
    end
    %     pause
end


